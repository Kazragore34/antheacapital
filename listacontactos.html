<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Contactos - Anthea Capital</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f1419 100%);
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #0f1419;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        h1 {
            text-align: center;
            color: #C9A961;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 2px 10px rgba(201, 169, 97, 0.3);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            background: #1a1f2e;
            border: 2px solid #374151;
            border-radius: 8px;
            color: #ffffff;
            font-size: 16px;
        }

        .search-box:focus {
            outline: none;
            border-color: #C9A961;
            box-shadow: 0 0 0 3px rgba(201, 169, 97, 0.1);
        }

        .filter-select {
            padding: 12px 20px;
            background: #1a1f2e;
            border: 2px solid #374151;
            border-radius: 8px;
            color: #ffffff;
            font-size: 16px;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #C9A961;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: linear-gradient(135deg, #C9A961 0%, #8B6914 100%);
            padding: 15px 25px;
            border-radius: 8px;
            color: #000000;
            font-weight: bold;
            font-size: 18px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #374151;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #1a1f2e;
        }

        thead {
            background: linear-gradient(135deg, #C9A961 0%, #8B6914 100%);
            color: #000000;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #374151;
            font-size: 14px;
        }

        tbody tr {
            transition: background-color 0.2s;
        }

        tbody tr:hover {
            background: #2d3748;
        }

        tbody tr:nth-child(even) {
            background: #1f2937;
        }

        tbody tr:nth-child(even):hover {
            background: #2d3748;
        }

        .empty-cell {
            color: #6b7280;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #C9A961;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #ef4444;
            font-size: 18px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 10px 20px;
            background: #1a1f2e;
            border: 2px solid #374151;
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-btn:hover {
            background: #C9A961;
            border-color: #C9A961;
            color: #000000;
        }

        .page-btn.active {
            background: #C9A961;
            border-color: #C9A961;
            color: #000000;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
            }

            .search-box,
            .filter-select {
                width: 100%;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“‹ Lista de Contactos - Propiedades</h1>
        
        <div class="controls">
            <input 
                type="text" 
                id="searchInput" 
                class="search-box" 
                placeholder="ðŸ” Buscar en todas las columnas..."
            />
            <select id="columnFilter" class="filter-select">
                <option value="">Todas las columnas</option>
            </select>
        </div>

        <div class="stats">
            <div class="stat-card">
                <span id="totalCount">0</span> propiedades
            </div>
            <div class="stat-card">
                Mostrando: <span id="showingCount">0</span>
            </div>
        </div>

        <div class="table-container">
            <div id="loading" class="loading">Cargando datos...</div>
            <div id="error" class="error" style="display: none;"></div>
            <table id="dataTable" style="display: none;">
                <thead id="tableHead"></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <div class="pagination" id="pagination"></div>
    </div>

    <script>
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        const itemsPerPage = 50;
        let columns = [];

        // Cargar y parsear XML
        async function loadXML() {
            try {
                const response = await fetch('archivos en bruto/listado.xml');
                if (!response.ok) {
                    throw new Error('No se pudo cargar el archivo XML');
                }
                const text = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(text, 'text/xml');
                
                // Verificar errores de parsing
                const parserError = xmlDoc.querySelector('parsererror');
                if (parserError) {
                    throw new Error('Error al parsear el XML: ' + parserError.textContent);
                }

                const propiedades = xmlDoc.querySelectorAll('propiedad');
                
                if (propiedades.length === 0) {
                    throw new Error('No se encontraron propiedades en el XML');
                }

                // Extraer todas las columnas Ãºnicas de la primera propiedad
                const firstProp = propiedades[0];
                const allNodes = firstProp.querySelectorAll('*');
                columns = Array.from(allNodes).map(node => node.tagName).filter((v, i, a) => a.indexOf(v) === i);

                // Procesar todas las propiedades
                allData = Array.from(propiedades).map(prop => {
                    const row = {};
                    columns.forEach(col => {
                        const node = prop.querySelector(col);
                        if (node) {
                            row[col] = node.textContent.trim() || '';
                        } else {
                            row[col] = '';
                        }
                    });
                    return row;
                });

                filteredData = [...allData];
                document.getElementById('totalCount').textContent = allData.length;
                
                // Llenar el selector de columnas
                const columnFilter = document.getElementById('columnFilter');
                columns.forEach(col => {
                    const option = document.createElement('option');
                    option.value = col;
                    option.textContent = col.replace(/_/g, ' ').replace(/([A-Z])/g, ' $1').trim();
                    columnFilter.appendChild(option);
                });

                renderTable();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dataTable').style.display = 'table';
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Error: ' + error.message;
                console.error(error);
            }
        }

        // Renderizar tabla
        function renderTable() {
            const tableHead = document.getElementById('tableHead');
            const tableBody = document.getElementById('tableBody');
            
            // Limpiar tabla
            tableHead.innerHTML = '';
            tableBody.innerHTML = '';

            // Crear encabezados
            const headerRow = document.createElement('tr');
            columns.forEach(col => {
                const th = document.createElement('th');
                th.textContent = col.replace(/_/g, ' ').replace(/([A-Z])/g, ' $1').trim();
                headerRow.appendChild(th);
            });
            tableHead.appendChild(headerRow);

            // Calcular paginaciÃ³n
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);

            // Crear filas
            pageData.forEach(row => {
                const tr = document.createElement('tr');
                columns.forEach(col => {
                    const td = document.createElement('td');
                    const value = row[col] || '';
                    td.textContent = value || '';
                    if (!value) {
                        td.classList.add('empty-cell');
                        td.textContent = '-';
                    }
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });

            // Actualizar estadÃ­sticas
            document.getElementById('showingCount').textContent = 
                `${startIndex + 1}-${Math.min(endIndex, filteredData.length)} de ${filteredData.length}`;

            // Renderizar paginaciÃ³n
            renderPagination();
        }

        // Renderizar paginaciÃ³n
        function renderPagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            // BotÃ³n anterior
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.textContent = 'â† Anterior';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                }
            };
            pagination.appendChild(prevBtn);

            // NÃºmeros de pÃ¡gina
            const maxVisible = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);

            if (endPage - startPage < maxVisible - 1) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }

            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.className = 'page-btn';
                firstBtn.textContent = '1';
                firstBtn.onclick = () => {
                    currentPage = 1;
                    renderTable();
                };
                pagination.appendChild(firstBtn);

                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '10px';
                    pagination.appendChild(ellipsis);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'page-btn' + (i === currentPage ? ' active' : '');
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage = i;
                    renderTable();
                };
                pagination.appendChild(pageBtn);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '10px';
                    pagination.appendChild(ellipsis);
                }

                const lastBtn = document.createElement('button');
                lastBtn.className = 'page-btn';
                lastBtn.textContent = totalPages;
                lastBtn.onclick = () => {
                    currentPage = totalPages;
                    renderTable();
                };
                pagination.appendChild(lastBtn);
            }

            // BotÃ³n siguiente
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.textContent = 'Siguiente â†’';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                }
            };
            pagination.appendChild(nextBtn);
        }

        // FunciÃ³n de bÃºsqueda
        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const columnFilter = document.getElementById('columnFilter').value;

            filteredData = allData.filter(row => {
                if (columnFilter) {
                    // Buscar solo en la columna seleccionada
                    const value = (row[columnFilter] || '').toLowerCase();
                    return value.includes(searchTerm);
                } else {
                    // Buscar en todas las columnas
                    return columns.some(col => {
                        const value = (row[col] || '').toLowerCase();
                        return value.includes(searchTerm);
                    });
                }
            });

            currentPage = 1;
            document.getElementById('totalCount').textContent = filteredData.length;
            renderTable();
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', filterData);
        document.getElementById('columnFilter').addEventListener('change', filterData);

        // Cargar datos al iniciar
        loadXML();
    </script>
</body>
</html>

